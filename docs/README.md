# pypix-api Documentation

This directory contains the source files for the pypix-api documentation, built using [Sphinx](https://www.sphinx-doc.org/).

## üìö Documentation Structure

```
docs/
‚îú‚îÄ‚îÄ index.rst           # Main documentation index
‚îú‚îÄ‚îÄ installation.rst    # Installation guide
‚îú‚îÄ‚îÄ quickstart.rst      # Quick start guide
‚îú‚îÄ‚îÄ usage.rst          # Usage examples
‚îú‚îÄ‚îÄ api_reference.rst  # Manual API reference
‚îú‚îÄ‚îÄ banks/             # Bank-specific documentation
‚îú‚îÄ‚îÄ security.rst       # Security guide
‚îú‚îÄ‚îÄ contributing.rst   # Contribution guide
‚îú‚îÄ‚îÄ changelog.rst      # Changelog
‚îú‚îÄ‚îÄ conf.py           # Sphinx configuration
‚îú‚îÄ‚îÄ api/              # Auto-generated API docs (created by sphinx-apidoc)
‚îî‚îÄ‚îÄ _build/           # Built documentation (ignored by git)
```

## üöÄ Building Documentation

### Prerequisites

```bash
# Install documentation dependencies
pip install -e ".[docs]"
```

### Build Commands

```bash
# Build documentation locally
make docs

# Build with auto-generated API documentation
make docs-full

# Serve documentation locally (http://localhost:8000)
make docs-serve

# Watch for changes and auto-rebuild
make docs-watch

# Check for broken links
make docs-linkcheck

# Prepare for GitHub Pages deployment
make docs-github
```

## üîß Development Workflow

### Adding New Documentation

1. **Create new `.rst` files** in the appropriate directory
2. **Add to `index.rst`** toctree to include in navigation
3. **Build locally** to test: `make docs`
4. **Check links** before committing: `make docs-linkcheck`

### Writing Style Guide

- Use **reStructuredText (RST)** for main documentation
- Use **Markdown (.md)** for simple guides (supported via MyST)
- Follow [Google Style Docstrings](https://google.github.io/styleguide/pyguide.html#38-comments-and-docstrings) in Python code
- Keep line length under 88 characters
- Use meaningful section headings with proper hierarchy

### API Documentation

API documentation is automatically generated from Python docstrings using:

```bash
# Generate API docs from source code
sphinx-apidoc -o api/ ../pypix_api/ --force --module-first
```

This is automatically run by `make docs-full` and in CI/CD.

## üåê GitHub Pages Deployment

Documentation is automatically deployed to GitHub Pages when:

- **Main branch changes** affecting documentation
- **Pull requests** create preview builds
- **Releases** update the live documentation

### Deployment Process

1. **Triggered** by changes to `docs/`, `pypix_api/`, or `pyproject.toml`
2. **Built** using Sphinx with all extensions
3. **Tested** for broken links and common issues
4. **Deployed** to https://laddertech.github.io/pypix-api/

### Configuration

- **Canonical URL**: `https://laddertech.github.io/pypix-api/`
- **Theme**: Read the Docs (sphinx_rtd_theme)
- **Extensions**: autodoc, autosummary, napoleon, viewcode, intersphinx, githubpages
- **Source formats**: RST and Markdown (MyST)

## üìù Writing Docstrings

### Example Function Documentation

```python
def create_pix_payment(amount: Decimal, recipient_key: str, description: str = None) -> dict:
    """Create a PIX payment request.

    This function creates a new PIX payment with the specified amount and recipient.
    The payment follows the PIX protocol standards defined by the Central Bank of Brazil.

    Args:
        amount: Payment amount in Brazilian Reais (BRL). Must be positive.
        recipient_key: PIX key of the payment recipient. Can be CPF, CNPJ, email,
            phone number, or random key.
        description: Optional payment description. Maximum 140 characters.

    Returns:
        Dict containing the payment request details:

        - txid (str): Transaction ID generated by the bank
        - qr_code (str): Base64-encoded QR code for payment
        - expiration (datetime): Payment expiration time

    Raises:
        ValueError: If amount is negative or zero
        APIError: If the bank API request fails
        ValidationError: If the PIX key format is invalid

    Example:
        >>> payment = create_pix_payment(
        ...     amount=Decimal('100.50'),
        ...     recipient_key='user@example.com',
        ...     description='Service payment'
        ... )
        >>> print(payment['txid'])
        'E35670098202104122141070F8DEF6E1'
    """
    # Implementation here
    pass
```

### Class Documentation

```python
class OAuth2Client:
    """OAuth2 client for bank API authentication.

    This client handles the OAuth2 authentication flow required by Brazilian banks
    for PIX API access, including certificate-based mutual TLS authentication.

    Attributes:
        client_id: OAuth2 client identifier provided by the bank
        scope: Permission scope for API access (e.g., 'pix.read pix.write')

    Example:
        >>> client = OAuth2Client(
        ...     client_id='your-client-id',
        ...     client_secret='your-secret',
        ...     cert_path='path/to/cert.p12',
        ...     cert_password='cert-password',
        ...     scope='pix.read pix.write'
        ... )
        >>> token = client.get_token()
        >>> print(f"Access token: {token}")
    """
```

## üîç Quality Checks

The documentation pipeline includes several quality checks:

### Automated Checks

- **Build warnings**: Sphinx reports all warnings as errors in CI
- **Link checking**: All external links are validated
- **Style checking**: doc8 validates RST formatting
- **HTML validation**: Basic HTML structure validation

### Manual Review

- **Content accuracy**: Ensure examples work and are current
- **Completeness**: All public APIs should be documented
- **Clarity**: Documentation should be clear for new users
- **Security**: No sensitive information in examples

## üêõ Troubleshooting

### Common Issues

**Build fails with import errors:**
```bash
# Ensure package is installed in development mode
pip install -e ".[dev,docs]"
```

**API docs not updating:**
```bash
# Force regeneration of API docs
rm -rf docs/api/
make docs-api
```

**Local server not accessible:**
```bash
# Try different port if 8000 is busy
cd docs/_build/html && python -m http.server 8001
```

**Links showing as broken:**
```bash
# Run link check to see details
make docs-linkcheck
# Check docs/_build/linkcheck/output.txt for details
```

## üìö Resources

- [Sphinx Documentation](https://www.sphinx-doc.org/)
- [reStructuredText Primer](https://www.sphinx-doc.org/en/master/usage/restructuredtext/basics.html)
- [MyST Markdown Guide](https://myst-parser.readthedocs.io/)
- [Napoleon Extension (Google Style)](https://www.sphinx-doc.org/en/master/usage/extensions/napoleon.html)
- [Read the Docs Theme](https://sphinx-rtd-theme.readthedocs.io/)

## ü§ù Contributing

When contributing to documentation:

1. **Follow the style guide** described above
2. **Test locally** before submitting PR
3. **Include examples** for new features
4. **Update API docs** if changing public interfaces
5. **Check spelling** and grammar

All documentation contributions are welcome! üéâ
